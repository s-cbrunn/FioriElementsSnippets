/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/mdc/library","../ActionToolbar","sap/m/Title","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/ui/mdc/chart/ChartTypeButton","sap/ui/mdc/chart/ChartSettings","sap/ui/core/library","sap/ui/Device","sap/ui/core/ShortcutHintsMixin","sap/ui/mdc/actiontoolbar/ActionToolbarAction"],function(E,M,A,T,O,a,C,b,c,D,S,d){"use strict";var e=E.extend("sap.ui.mdc.ToolbarHandler",{});var f=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var H=c.aria.HasPopup;e.prototype.createToolbar=function(o,u,i){u=u||[];if(!o.getAggregation("_toolbar")){var t=new A(o.getId()+"--toolbar",{design:"Transparent",begin:[new T(o.getId()+"-title",{text:o.getHeader()})]});o.setAggregation("_toolbar",t);this.initializeToolbarNotBound(o);this.addActions(t,u);if(!i){this.updateToolbar(o);}}};e.prototype.addActions=function(t,g){g.forEach(function(h){t.addAction(h);});};e.prototype.initializeToolbarNotBound=function(o){var t=o.getAggregation("_toolbar");if(!t){return;}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.ZoomInOut)){this._oZoomInButton=new O({tooltip:f.getText("chart.TOOLBAR_ZOOM_IN"),icon:"sap-icon://zoom-in",enabled:"{= ${$mdcChart>/_chart/getZoomInfo/enabled} && ${$mdcChart>/_chart/getZoomInfo/currentZoomLevel} < 1}"});this._oZoomOutButton=new O({tooltip:f.getText("chart.TOOLBAR_ZOOM_OUT"),icon:"sap-icon://zoom-out",enabled:"{= ${$mdcChart>/_chart/getZoomInfo/enabled} && ${$mdcChart>/_chart/getZoomInfo/currentZoomLevel} > 0}"});t.addEnd(this._oZoomInButton);t.addEnd(this._oZoomOutButton);}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.DrillDownUp)<0){o._oDrillDownBtn=new O(o.getId()+"-drillDown",{icon:"sap-icon://drill-down",enabled:false,tooltip:f.getText("chart.CHART_DRILLDOWN_TITLE"),text:f.getText("chart.CHART_DRILLDOWN_TITLE"),press:[o._showDrillDown,o]});t.addEnd(o._oDrillDownBtn);}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.Legend)<0){this._legendBtn=new a(o.getId()+"-chart_legend",{type:"Transparent",text:f.getText("chart.LEGENDBTN_TEXT"),tooltip:f.getText('chart.LEGENDBTN_TOOLTIP'),icon:"sap-icon://legend",enabled:false,pressed:false});t.addEnd(this._legendBtn);}var p=o.getP13nMode()||[];if(p.indexOf("Item")>-1){this._chartSettingsBtn=new O(o.getId()+"-chart_settings",{tooltip:f.getText('chart.PERSONALIZATION_DIALOG_TITLE'),text:f.getText('chart.PERSONALIZATION_DIALOG_TITLE'),icon:"sap-icon://action-settings",ariaHasPopup:H.ListBox,enabled:false});t.addEnd(this._chartSettingsBtn);S.addConfig(this._chartSettingsBtn,{addAccessibilityLabel:true,messageBundleKey:D.os.macintosh?"mdc.PERSONALIZATION_SHORTCUT_MAC":"mdc.PERSONALIZATION_SHORTCUT"},o);}if(p.indexOf("Sort")>-1){this._sortBtn=new O(o.getId()+"-sort_settings",{ariaHasPopup:H.ListBox,icon:"sap-icon://sort",tooltip:f.getText('sort.PERSONALIZATION_DIALOG_TITLE'),text:f.getText('sort.PERSONALIZATION_DIALOG_TITLE'),enabled:false});t.addEnd(this._sortBtn);}if(p.indexOf("Type")>-1){this._chartTypeBtn=new C(o);t.addEnd(this._chartTypeBtn);}t.setEnabled(false);};e.prototype.updateToolbar=function(o){var t=o.getAggregation("_toolbar");if(!t){return;}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.ZoomInOut)){var i=o.getAggregation("_chart");this._oZoomInButton.setTooltip(f.getText("chart.TOOLBAR_ZOOM_IN"));this._oZoomInButton.setText(f.getText("chart.TOOLBAR_ZOOM_IN"));this._oZoomInButton.attachPress(function h(g){this.handleZoomIn(i,this._oZoomInButton,this._oZoomOutButton);}.bind(this));this._oZoomOutButton.setTooltip(f.getText("chart.TOOLBAR_ZOOM_OUT"));this._oZoomOutButton.setText(f.getText("chart.TOOLBAR_ZOOM_OUT"));this._oZoomOutButton.attachPress(function h(g){this.handleZoomOut(i,this._oZoomInButton,this._oZoomOutButton);}.bind(this));if(i){i.attachRenderComplete(function h(g){var z=i.getZoomInfo();this.handleInnerChartRenderCompleted(z,this._oZoomInButton,this._oZoomOutButton);},this);}}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.DrillDownUp)<0){o._oDrillDownBtn.setEnabled(true);}if(!o.getIgnoreToolbarActions().length||o.getIgnoreToolbarActions().indexOf(M.ChartToolbarActionType.Legend)<0){this._legendBtn.setEnabled(true);this._legendBtn.setPressed(o.getLegendVisible());this._legendBtn.attachPress(function(){o.setLegendVisible(!o.getLegendVisible());this._legendBtn.setPressed(o.getLegendVisible());}.bind(this));}var p=o.getP13nMode()||[];if(p.indexOf("Item")>-1){this._chartSettingsBtn.setEnabled(true);this._chartSettingsBtn.attachPress(function(g){var s=g.getSource();o._getPropertyData().then(function(P){b.showPanel(o,"Chart",s,P);});});}if(p.indexOf("Sort")>-1){this._sortBtn.setEnabled(true);this._sortBtn.attachPress(function(g){var s=g.getSource();o._getPropertyData().then(function(P){b.showPanel(o,"Sort",s,P);});});}if(p.indexOf("Type")>-1){this._chartTypeBtn.bindToInnerChart(o);}t.setEnabled(true);};e.prototype.handleInnerChartRenderCompleted=function(z,Z,o){this.toggleZoomButtonsEnabledState(z,Z,o);};e.prototype.handleZoomIn=function(i,z,Z){i.zoom({direction:"in"});var o=i.getZoomInfo();this.toggleZoomButtonsEnabledState(o,z,Z);};e.prototype.handleZoomOut=function(i,z,Z){i.zoom({direction:"out"});var o=i.getZoomInfo();this.toggleZoomButtonsEnabledState(o,z,Z);};e.prototype.toggleZoomButtonsEnabledState=function(z,Z,o){var v=z.currentZoomLevel;if(v==null){Z.setEnabled(false);o.setEnabled(false);return;}if(v===0){Z.setEnabled(true);o.setEnabled(false);if(o.getFocusDomRef()===document.activeElement){Z.focus();}return;}if(v===1){o.setEnabled(true);Z.setEnabled(false);if(Z.getFocusDomRef()===document.activeElement){o.focus();}return;}Z.setEnabled(true);o.setEnabled(true);};return e;});
