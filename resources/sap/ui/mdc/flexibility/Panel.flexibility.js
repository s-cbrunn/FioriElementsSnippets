/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/fl/changeHandler/Base'],function(B){"use strict";return{createChanges:function(p,d){var n=d.filter(function(D){return!sap.ui.getCore().byId(D.id);});var N={};return n.reduce(function(r,D){if(!N[D.id]){N[D.id]=true;r.push(D);}return r;},[]).map(function(D){return{selectorElement:p,changeSpecificData:{changeType:"createItem",content:{selector:D.id}}};});},createItem:{layers:{USER:true},changeHandler:{applyChange:function(c,p,P){var s=c.getContent().selector;return Promise.resolve().then(function(){p.getModel();return P.modifier.getProperty(p,"metadataHelperPath");}).then(function(m){return new Promise(function(r,a){sap.ui.require(['sap/ui/mdc/link/PanelItem',m],function(b,M){r(M);},function(e){a(e);});});}).then(function(M){var m=P.modifier;if(m.bySelector(s,P.appComponent,P.view)){return undefined;}var a=M.retrieveAllMetadata(p);var i;var I=function(b,d){var f=-1;d.some(function(o,e){if(o.getId()===b){f=e;return true;}});return f;};var b=m.getControlIdBySelector(s,P.appComponent);return Promise.resolve().then(m.getAggregation.bind(m,p,"items")).then(function(d){i=-1;var o=null;a.some(function(e){var f=I(e.id,d);if(f>-1){i=f;}if(e.id===b){o=e;return true;}});if(!o){return undefined;}return m.createControl("sap.ui.mdc.link.PanelItem",P.appComponent,P.view,o.id,{text:o.text,description:o.description,href:o.href,target:o.target,icon:o.icon,visible:o.visible});}).then(function(o){return m.insertAggregation(p,"items",o,i+1);});});},revertChange:function(c,p,P){var m=P.modifier;if(c.getContent()&&c.getContent().selector){var i=c.getContent().selector.id;var I=m.bySelector(i,P.appComponent,P.view);if(!I){return B.markAsNotApplicable("revertChange of createItem: the item with id "+i+" is not existing and therefore can not be removed.",true);}return Promise.resolve().then(m.removeAggregation.bind(m,p,"items",I));}},completeChangeContent:function(c,s,p){if(s.content){var S=p.modifier.getSelector(s.content.selector,p.appComponent);var C=c.getDefinition();C.content={selector:S};}}}}};},true);
