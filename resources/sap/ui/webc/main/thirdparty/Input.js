sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/Render","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/util/Caret","sap/ui/webc/common/thirdparty/icons/decline","./types/InputType","./Popover","./generated/templates/InputTemplate.lit","./generated/templates/InputPopoverTemplate.lit","./generated/i18n/i18n-defaults","./generated/themes/Input.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css"],function(e,t,s,i,n,a,o,r,u,h,g,l,p,c,d,S,f,m,v,I,_){"use strict";function T(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var y=T(e);var E=T(t);var w=T(s);var b=T(a);var P=T(u);const N=new RegExp(/(\+|-)?\d+(\.|,)\d+/);const A={tag:"ui5-input",languageAware:true,managedSlots:true,slots:{icon:{type:HTMLElement},default:{propertyName:"suggestionItems",type:HTMLElement},formSupport:{type:HTMLElement},valueStateMessage:{type:HTMLElement}},properties:{disabled:{type:Boolean},highlight:{type:Boolean},placeholder:{type:String},readonly:{type:Boolean},required:{type:Boolean},type:{type:c,defaultValue:c.Text},value:{type:String},valueState:{type:b,defaultValue:b.None},name:{type:String},showSuggestions:{type:Boolean},maxlength:{type:P},accessibleName:{type:String},accessibleNameRef:{type:String,defaultValue:""},focused:{type:Boolean},_input:{type:Object},_inputAccInfo:{type:Object},_nativeInputAttributes:{type:Object},_inputWidth:{type:P},_listWidth:{type:P},_isPopoverOpen:{type:Boolean,noAttribute:true},_inputIconFocused:{type:Boolean,noAttribute:true}},events:{change:{},input:{},"suggestion-item-select":{detail:{item:{type:HTMLElement}}},"suggestion-item-preview":{detail:{item:{type:HTMLElement},targetRef:{type:HTMLElement}}},"suggestion-scroll":{detail:{scrollTop:{type:P},scrollContainer:{type:HTMLElement}}}}};class R extends y{static get metadata(){return A}static get render(){return E}static get template(){return S}static get staticAreaTemplate(){return f}static get styles(){return v}static get staticAreaStyles(){return[I,_]}constructor(){super();this.hasSuggestionItemSelected=false;this.valueBeforeItemSelection="";this.valueBeforeItemPreview="";this.suggestionSelectionCanceled=false;this._changeFired=false;this.previousValue=undefined;this.firstRendering=true;this.highlightValue="";this._backspaceKeyDown=false;this.EVENT_CHANGE="change";this.EVENT_INPUT="input";this.EVENT_SUGGESTION_ITEM_SELECT="suggestion-item-select";this.ACTION_ENTER="enter";this.ACTION_USER_INPUT="input";this.suggestionsTexts=[];this.i18nBundle=h.getI18nBundle("@ui5/webcomponents");this._handleResizeBound=this._handleResize.bind(this)}onEnterDOM(){w.register(this,this._handleResizeBound)}onExitDOM(){w.deregister(this,this._handleResizeBound)}onBeforeRendering(){if(this.showSuggestions){this.enableSuggestions();this.suggestionsTexts=this.Suggestions.defaultSlotProperties(this.highlightValue)}const e=o.getFeature("FormSupport");if(e){e.syncNativeHiddenInput(this)}else if(this.name){console.warn(`In order for the "name" property to have effect, you should also: import "@ui5/webcomponents/dist/features/InputElementsFormSupport.js";`)}}async onAfterRendering(){if(!this.firstRendering&&!n.isPhone()&&this.Suggestions){const e=this.shouldOpenSuggestions();this.Suggestions.toggle(e,{preventFocusRestore:!this.hasSuggestionItemSelected});await i.renderFinished();this._listWidth=await this.Suggestions._getListWidth();if(!n.isPhone()&&e){(await this.getInputDOMRef()).focus()}}if(!this.firstRendering&&this.hasValueStateMessage){this.toggle(this.shouldDisplayOnlyValueStateMessage)}this.firstRendering=false}_onkeydown(e){if(r.isUp(e)){return this._handleUp(e)}if(r.isDown(e)){return this._handleDown(e)}if(r.isSpace(e)){return this._handleSpace(e)}if(r.isTabNext(e)){return this._handleTab(e)}if(r.isEnter(e)){return this._handleEnter(e)}if(r.isEscape(e)){return this._handleEscape(e)}if(r.isBackSpace(e)){this._backspaceKeyDown=true;this._selectedText=window.getSelection().toString()}if(this.showSuggestions){this.Suggestions._deselectItems()}this._keyDown=true}_onkeyup(e){this._keyDown=false;this._backspaceKeyDown=false}_handleUp(e){if(this.Suggestions&&this.Suggestions.isOpened()){this.Suggestions.onUp(e)}}_handleDown(e){if(this.Suggestions&&this.Suggestions.isOpened()){this.Suggestions.onDown(e)}}_handleSpace(e){if(this.Suggestions){this.Suggestions.onSpace(e)}}_handleTab(e){if(this.Suggestions&&this.previousValue!==this.value){this.Suggestions.onTab(e)}}_handleEnter(e){const t=!!(this.Suggestions&&this.Suggestions.onEnter(e));if(!t){this.fireEventByAction(this.ACTION_ENTER)}}_handleEscape(){if(this.showSuggestions&&this.Suggestions&&this.Suggestions._isItemOnTarget()){this.value=this.valueBeforeItemPreview;this.suggestionSelectionCanceled=true}}async _onfocusin(e){await this.getInputDOMRef();this.focused=true;this.previousValue=this.value;this.valueBeforeItemPreview=this.value;this._inputIconFocused=e.target&&e.target===this.querySelector("[ui5-icon]")}_onfocusout(e){const t=this.Suggestions&&e.relatedTarget&&e.relatedTarget.shadowRoot&&e.relatedTarget.shadowRoot.contains(this.Suggestions.responsivePopover);const s=e.relatedTarget&&e.relatedTarget.shadowRoot&&e.relatedTarget.shadowRoot.querySelector(".ui5-valuestatemessage-root");if(t||s){e.stopImmediatePropagation();return}const i=e.relatedTarget;if(i&&i.classList.contains(this._id)){return}this.closePopover();this.previousValue="";this.focused=false}_click(e){if(n.isPhone()&&!this.readonly&&this.Suggestions){this.Suggestions.open();this.isRespPopoverOpen=true}}_handleChange(e){if(!this._changeFired){this.fireEvent(this.EVENT_CHANGE)}this._changeFired=false}_scroll(e){const t=e.detail;this.fireEvent("suggestion-scroll",{scrollTop:t.scrollTop,scrollContainer:t.targetRef})}async _handleInput(e){const t=await this.getInputDOMRef();const s=this.value&&this.isTypeNumber&&!t.value;this.suggestionSelectionCanceled=false;if(s&&!this._backspaceKeyDown){return}if(s&&this._backspaceKeyDown){if(N.test(this.value)&&this._selectedText!==this.value){const e=this.removeFractionalPart(this.value);this.value=e;this.highlightValue=e;this.valueBeforeItemPreview=e;this.fireEvent(this.EVENT_INPUT);this.fireEvent("value-changed");return}}if(e.target===t){e.stopImmediatePropagation()}const i=t.value===this.value&&n.isIE()&&!this._keyDown&&!!this.placeholder;!i&&this.fireEventByAction(this.ACTION_USER_INPUT);this.hasSuggestionItemSelected=false;if(this.Suggestions){this.Suggestions.updateSelectedItemPosition(null)}}_handleResize(){this._inputWidth=this.offsetWidth}_closeRespPopover(e){this.Suggestions.close(e)}async _afterOpenPopover(){if(n.isPhone()){(await this.getInputDOMRef()).focus()}}_afterClosePopover(){this.announceSelectedItem();if(n.isPhone()){this.blur()}}toggle(e){if(e&&!this.isRespPopoverOpen){this.openPopover()}else{this.closePopover()}}isValueStateOpened(){return!!this._isPopoverOpen}async openPopover(){const e=await this._getPopover();if(e){this._isPopoverOpen=true;e.showAt(this)}}async closePopover(){const e=await this._getPopover();e&&e.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e&&e.querySelector("[ui5-popover]")}enableSuggestions(){if(this.Suggestions){return}const e=o.getFeature("InputSuggestions");if(e){this.Suggestions=new e(this,"suggestionItems",true)}else{throw new Error(`You have to import "@ui5/webcomponents/dist/features/InputSuggestions.js" module to use ui5-input suggestions`)}}shouldOpenSuggestions(){return!!(this.suggestionItems.length&&this.focused&&this.showSuggestions&&!this.hasSuggestionItemSelected&&!this.suggestionSelectionCanceled)}selectSuggestion(e,t){if(e.group){return}const s=e.text||e.textContent;const i=t?this.valueBeforeItemSelection!==s:this.value!==s;this.hasSuggestionItemSelected=true;if(i){this.value=s;this.valueBeforeItemSelection=s;this.fireEvent(this.EVENT_INPUT);this.fireEvent(this.EVENT_CHANGE);this._changeFired=true}this.valueBeforeItemPreview="";this.suggestionSelectionCanceled=false;this.fireEvent(this.EVENT_SUGGESTION_ITEM_SELECT,{item:e})}previewSuggestion(e){this.valueBeforeItemSelection=this.value;this.updateValueOnPreview(e);this.announceSelectedItem();this._previewItem=e}updateValueOnPreview(e){const t=e.type==="Inactive"||e.group;const s=t?"":e.effectiveTitle||e.textContent;this.value=s}get previewItem(){if(!this._previewItem){return null}return this.getSuggestionByListItem(this._previewItem)}async fireEventByAction(e){await this.getInputDOMRef();if(this.disabled||this.readonly){return}const t=await this.getInputValue();const s=e===this.ACTION_USER_INPUT;const i=await this.getInputDOMRef();const a=i.selectionStart;this.value=t;this.highlightValue=t;this.valueBeforeItemPreview=t;if(n.isSafari()){setTimeout(()=>{i.selectionStart=a;i.selectionEnd=a},0)}if(s){this.fireEvent(this.EVENT_INPUT);this.fireEvent("value-changed");return}const o=this.previousValue!==undefined&&this.previousValue!==this.value;if(n.isIE()&&e===this.ACTION_ENTER&&o){this.fireEvent(this.EVENT_CHANGE)}}async getInputValue(){const e=this.getDomRef();if(e){return(await this.getInputDOMRef()).value}return""}async getInputDOMRef(){if(n.isPhone()&&this.Suggestions&&this.suggestionItems.length){await this.Suggestions._respPopover();return this.Suggestions&&this.Suggestions.responsivePopover.querySelector(".ui5-input-inner-phone")}return this.nativeInput}get nativeInput(){return this.getDomRef()&&this.getDomRef().querySelector(`input`)}get nativeInputWidth(){return this.nativeInput&&this.nativeInput.offsetWidth}getLabelableElementId(){return this.getInputId()}getSuggestionByListItem(e){const t=parseInt(e.getAttribute("data-ui5-key"));return this.suggestionItems[t]}isSuggestionsScrollable(){if(!this.Suggestions){return Promise.resolve(false)}return this.Suggestions._isScrollable()}getInputId(){return`${this._id}-inner`}onItemFocused(){}onItemMouseOver(e){const t=e.target;const s=this.getSuggestionByListItem(t);s&&s.fireEvent("mouseover",{item:s,targetRef:t})}onItemMouseOut(e){const t=e.target;const s=this.getSuggestionByListItem(t);s&&s.fireEvent("mouseout",{item:s,targetRef:t})}onItemSelected(e,t){this.selectSuggestion(e,t)}onItemPreviewed(e){this.previewSuggestion(e);this.fireEvent("suggestion-item-preview",{item:this.getSuggestionByListItem(e),targetRef:e})}onOpen(){}onClose(){}valueStateTextMappings(){const e=this.i18nBundle;return{Success:e.getText(m.VALUE_STATE_SUCCESS),Information:e.getText(m.VALUE_STATE_INFORMATION),Error:e.getText(m.VALUE_STATE_ERROR),Warning:e.getText(m.VALUE_STATE_WARNING)}}announceSelectedItem(){const e=this.shadowRoot.querySelector(`#${this._id}-selectionText`);if(this.Suggestions&&this.Suggestions._isItemOnTarget()){e.textContent=this.itemSelectionAnnounce}else{e.textContent=""}}get _readonly(){return this.readonly&&!this.disabled}get _headerTitleText(){return this.i18nBundle.getText(m.INPUT_SUGGESTIONS_TITLE)}get inputType(){return this.type.toLowerCase()}get isTypeNumber(){return this.type===c.Number}get suggestionsTextId(){return this.showSuggestions?`${this._id}-suggestionsText`:""}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:""}get accInfo(){const e=this.showSuggestions?"true":undefined;const t=this.showSuggestions?"list":undefined;const s=this._inputAccInfo.ariaDescribedBy?`${this.suggestionsTextId} ${this.valueStateTextId} ${this._inputAccInfo.ariaDescribedBy}`.trim():`${this.suggestionsTextId} ${this.valueStateTextId}`.trim();return{input:{ariaRoledescription:this._inputAccInfo&&(this._inputAccInfo.ariaRoledescription||undefined),ariaDescribedBy:s||undefined,ariaInvalid:this.valueState===b.Error?"true":undefined,ariaHasPopup:this._inputAccInfo.ariaHasPopup?this._inputAccInfo.ariaHasPopup:e,ariaAutoComplete:this._inputAccInfo.ariaAutoComplete?this._inputAccInfo.ariaAutoComplete:t,role:this._inputAccInfo&&this._inputAccInfo.role,ariaControls:this._inputAccInfo&&this._inputAccInfo.ariaControls,ariaExpanded:this._inputAccInfo&&this._inputAccInfo.ariaExpanded,ariaDescription:this._inputAccInfo&&this._inputAccInfo.ariaDescription,ariaLabel:this._inputAccInfo&&this._inputAccInfo.ariaLabel||g.getEffectiveAriaLabelText(this)}}}get nativeInputAttributes(){return{min:this.isTypeNumber?this._nativeInputAttributes.min:undefined,max:this.isTypeNumber?this._nativeInputAttributes.max:undefined,step:this.isTypeNumber?this._nativeInputAttributes.step||"any":undefined}}get ariaValueStateHiddenText(){if(!this.hasValueStateMessage){return}if(this.shouldDisplayDefaultValueStateMessage){return this.valueStateText}return this.valueStateMessageText.map(e=>e.textContent).join(" ")}get itemSelectionAnnounce(){return this.Suggestions?this.Suggestions.itemSelectionAnnounce:undefined}get classes(){return{popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-responsive-popover-header":!this.isValueStateOpened(),"ui5-valuestatemessage--success":this.valueState===b.Success,"ui5-valuestatemessage--error":this.valueState===b.Error,"ui5-valuestatemessage--warning":this.valueState===b.Warning,"ui5-valuestatemessage--information":this.valueState===b.Information}}}get styles(){const e={popoverHeader:{"max-width":`${this._inputWidth}px`},suggestionPopoverHeader:{display:this._listWidth===0?"none":"inline-block",width:`${this._listWidth}px`,padding:"0.925rem 1rem"},suggestionsPopover:{"max-width":`${this._inputWidth}px`},innerInput:{}};if(this.nativeInputWidth<48){e.innerInput.padding="0"}return e}get suggestionSeparators(){return"None"}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get shouldDisplayOnlyValueStateMessage(){return this.hasValueStateMessage&&!this.shouldOpenSuggestions()&&this.focused}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateMessage}get hasValueState(){return this.valueState!==b.None}get hasValueStateMessage(){return this.hasValueState&&this.valueState!==b.Success&&(!this._inputIconFocused||this._isPhone&&this.Suggestions)}get valueStateText(){return this.valueStateTextMappings()[this.valueState]}get suggestionsText(){return this.i18nBundle.getText(m.INPUT_SUGGESTIONS)}get availableSuggestionsCount(){if(this.showSuggestions&&(this.value||this.Suggestions.isOpened())){switch(this.suggestionsTexts.length){case 0:return this.i18nBundle.getText(m.INPUT_SUGGESTIONS_NO_HIT);case 1:return this.i18nBundle.getText(m.INPUT_SUGGESTIONS_ONE_HIT);default:return this.i18nBundle.getText(m.INPUT_SUGGESTIONS_MORE_HITS,this.suggestionsTexts.length)}}return undefined}get step(){return this.isTypeNumber?"any":undefined}get _isPhone(){return n.isPhone()}get _placeholder(){return this.placeholder}getCaretPosition(){return l.getCaretPosition(this.nativeInput)}setCaretPosition(e){l.setCaretPosition(this.nativeInput,e)}removeFractionalPart(e){if(e.includes(".")){return e.slice(0,e.indexOf("."))}if(e.includes(",")){return e.slice(0,e.indexOf(","))}return e}static get dependencies(){const e=o.getFeature("InputSuggestions");return[d].concat(e?e.dependencies:[])}static async onDefine(){await h.fetchI18nBundle("@ui5/webcomponents")}}R.define();return R});