sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/types/NavigationMode","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/util/debounce","sap/ui/webc/common/thirdparty/base/util/isElementInView","./types/TableGrowingMode","./BusyIndicator","./types/TableMode","./generated/i18n/i18n-defaults","./generated/templates/TableTemplate.lit","./generated/themes/Table.css"],function(e,t,i,n,s,o,r,l,a,d,h,c,u,g,p,m,b){"use strict";function w(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var f=w(e);var y=w(t);var _=w(i);var v=w(n);var E=w(s);var R=w(o);var I=w(d);var S=w(h);const C=250;const T={tag:"ui5-table",managedSlots:true,slots:{default:{propertyName:"rows",type:HTMLElement,individualSlots:true},columns:{type:HTMLElement,individualSlots:true,invalidateOnChildChange:{properties:true,slots:false}}},properties:{noDataText:{type:String},growingButtonText:{type:String},growingButtonSubtext:{type:String},hideNoData:{type:Boolean},growing:{type:c,defaultValue:c.None},busy:{type:Boolean},busyDelay:{type:E,defaultValue:1e3},stickyColumnHeader:{type:Boolean},mode:{type:g,defaultValue:g.None},_hiddenColumns:{type:Object,multiple:true},_noDataDisplayed:{type:Boolean},_loadMoreActive:{type:Boolean},_columnHeader:{type:Object},_inViewport:{type:Boolean},_allRowsSelected:{type:Boolean}},events:{"row-click":{detail:{row:{type:HTMLElement}}},"popin-change":{detail:{poppedColumns:{}}},"load-more":{},"selection-change":{detail:{selectedRows:{type:Array},previouslySelectedRows:{type:Array}}}}};class O extends f{static get metadata(){return T}static get styles(){return b}static get render(){return y}static get template(){return m}static get dependencies(){return[u]}static async onDefine(){await a.fetchI18nBundle("@ui5/webcomponents")}constructor(){super();this._columnHeader={id:`${this._id}-columnHeader`,_tabIndex:"0"};this._itemNavigation=new v(this,{navigationMode:R.Vertical,affectedPropertiesNames:["_columnHeader"],getItemsCallback:()=>[this._columnHeader,...this.rows]});this.fnOnRowFocused=this.onRowFocused.bind(this);this._handleResize=this.popinContent.bind(this);this.i18nBundle=a.getI18nBundle("@ui5/webcomponents");this.tableEndObserved=false;this.addEventListener("ui5-selection-requested",this._handleSelect.bind(this))}onBeforeRendering(){const e=this.getColumnPropagationSettings();const t=JSON.stringify(e);const i=this.rows.length;this.rows.forEach((n,s)=>{if(n._columnsInfoString!==t){n._columnsInfo=e;n._columnsInfoString=JSON.stringify(n._columnsInfo)}n._ariaPosition=this.i18nBundle.getText(p.TABLE_ROW_POSITION,s+1,i);n._busy=this.busy;n.removeEventListener("ui5-_focused",this.fnOnRowFocused);n.addEventListener("ui5-_focused",this.fnOnRowFocused);n.mode=this.mode});this.visibleColumns=this.columns.filter((e,t)=>{e.sticky=this.stickyColumnHeader;return!this._hiddenColumns[t]});this._noDataDisplayed=!this.rows.length&&!this.hideNoData;this.visibleColumnsCount=this.visibleColumns.length}onAfterRendering(){if(this.growsOnScroll){this.observeTableEnd()}this.checkTableInViewport()}onEnterDOM(){if(!r.isIE()){this.growingIntersectionObserver=this.getIntersectionObserver()}_.register(this.getDomRef(),this._handleResize)}onExitDOM(){_.deregister(this.getDomRef(),this._handleResize);if(!r.isIE()){this.growingIntersectionObserver.disconnect();this.growingIntersectionObserver=null;this.tableEndObserved=false}}onRowFocused(e){this._itemNavigation.setCurrentItem(e.target)}_onColumnHeaderClick(e){this.getColumnHeader().focus();this._itemNavigation.setCurrentItem(this._columnHeader)}_onLoadMoreKeydown(e){if(l.isSpace(e)){e.preventDefault();this._loadMoreActive=true}if(l.isEnter(e)){this._onLoadMoreClick();this._loadMoreActive=true}}_onLoadMoreKeyup(e){if(l.isSpace(e)){this._onLoadMoreClick()}this._loadMoreActive=false}_onLoadMoreClick(){this.fireEvent("load-more")}observeTableEnd(){if(!this.tableEndObserved){this.getIntersectionObserver().observe(this.tableEndDOM);this.tableEndObserved=true}}onInteresection(e){if(e.some(e=>e.isIntersecting)){I(this.loadMore.bind(this),C)}}loadMore(){this.fireEvent("load-more")}_handleSingleSelect(e){const t=this.getRowParent(e.target);if(!t.selected){const e=this.selectedRows;this.rows.forEach(e=>{if(e.selected){e.selected=false}});t.selected=true;this.fireEvent("selection-change",{selectedRows:[t],previouslySelectedRows:e})}}_handleMultiSelect(e){const t=this.getRowParent(e.target);const i=this.selectedRows;t.selected=!t.selected;const n=this.selectedRows;if(n.length===this.rows.length){this._allRowsSelected=true}else{this._allRowsSelected=false}this.fireEvent("selection-change",{selectedRows:n,previouslySelectedRows:i})}_handleSelect(e){this[`_handle${this.mode}`](e)}_selectAll(e){const t=e.target.checked;const i=this.rows.filter(e=>e.selected);this._allRowsSelected=t;this.rows.forEach(e=>{e.selected=t});const n=t?this.rows:[];this.fireEvent("selection-change",{selectedRows:n,previouslySelectedRows:i})}getRowParent(e){const t=e.parentElement;if(e.hasAttribute("ui5-table-row")){return e}if(t&&t.hasAttribute("ui5-table-row")){return t}this.getRowParent(t)}getColumnHeader(){return this.getDomRef()&&this.getDomRef().querySelector(`#${this._id}-columnHeader`)}handleResize(e){this.checkTableInViewport();this.popinContent(e)}checkTableInViewport(){this._inViewport=S(this.getDomRef())}popinContent(e){const t=this.getDomRef().getBoundingClientRect();const i=t.width;const n=[];const s=[];this.columns.forEach((e,t)=>{if(i<e.minWidth&&e.minWidth!==Infinity){n[t]={index:t,popinText:e.popinText,demandPopin:e.demandPopin}}else{s.push(t)}});if(s.length){if(!this.isMultiSelect){this.columns[s[0]].first=true}this.columns[s[s.length-1]].last=true}if(this._hiddenColumns.length!==n.length){this._hiddenColumns=n;if(n.length){this.fireEvent("popin-change",{poppedColumns:this._hiddenColumns})}}}getColumnPropagationSettings(){return this.columns.map((e,t)=>({index:t,minWidth:e.minWidth,demandPopin:e.demandPopin,text:e.textContent,popinText:e.popinText,visible:!this._hiddenColumns[t]}),this)}getIntersectionObserver(){if(!this.growingIntersectionObserver){this.growingIntersectionObserver=new IntersectionObserver(this.onInteresection.bind(this),{root:document,rootMargin:"0px",threshold:1})}return this.growingIntersectionObserver}get styles(){return{busy:{position:this.busyIndPosition}}}get growsWithButton(){if(r.isIE()){return this.growing===c.Button||this.growing===c.Scroll}return this.growing===c.Button}get growsOnScroll(){return!r.isIE()&&this.growing===c.Scroll}get _growingButtonText(){return this.growingButtonText||this.i18nBundle.getText(p.LOAD_MORE_TEXT)}get ariaLabelText(){const e=this.i18nBundle.getText(p.TABLE_HEADER_ROW_TEXT);const t=this.columns.map(e=>e.textContent.trim()).join(" ");return`${e} ${t}`}get ariaLabelSelectAllText(){return this.i18nBundle.getText(p.ARIA_LABEL_SELECT_ALL_CHECKBOX)}get loadMoreAriaLabelledBy(){if(this.moreDataText){return`${this._id}-growingButton-text ${this._id}-growingButton-subtext`}return`${this._id}-growingButton-text`}get tableEndDOM(){return this.shadowRoot.querySelector(".ui5-table-end-marker")}get busyIndPosition(){if(r.isIE()){return"absolute"}return this._inViewport?"absolute":"sticky"}get isMultiSelect(){return this.mode==="MultiSelect"}get selectedRows(){return this.rows.filter(e=>e.selected)}}O.define();return O});