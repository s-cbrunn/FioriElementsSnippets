sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/util/InvisibleMessage","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/icons/decline","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/Keys","./ComboBoxFilters-f59100bd","./generated/i18n/i18n-defaults","./generated/templates/ComboBoxTemplate.lit","./generated/templates/ComboBoxPopoverTemplate.lit","./generated/themes/ComboBox.css","./generated/themes/ComboBoxPopover.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./ComboBoxItem","./Icon","./Popover","./ResponsivePopover","./List","./BusyIndicator","./Button","./StandardListItem","./ComboBoxGroupItem"],function(e,t,s,i,o,r,a,n,l,h,u,p,c,d,m,f,v,g,_,I,P,S,y,T,b,x,V,E){"use strict";function R(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var w=R(e);var C=R(t);var B=R(s);var A=R(o);var M=R(a);const L={tag:"ui5-combobox",languageAware:true,properties:{value:{type:String,defaultValue:""},filterValue:{type:String,defaultValue:""},placeholder:{type:String,defaultValue:""},disabled:{type:Boolean},valueState:{type:B,defaultValue:B.None},readonly:{type:Boolean},required:{type:Boolean},loading:{type:Boolean},filter:{type:String,defaultValue:"StartsWithPerTerm"},focused:{type:Boolean},accessibleName:{type:String,defaultValue:undefined},accessibleNameRef:{type:String,defaultValue:""},_iconPressed:{type:Boolean,noAttribute:true},_filteredItems:{type:Object},_listWidth:{type:A,defaultValue:0,noAttribute:true}},managedSlots:true,slots:{default:{propertyName:"items",type:HTMLElement,invalidateOnChildChange:true},valueStateMessage:{type:HTMLElement},icon:{type:HTMLElement}},events:{change:{},input:{},"selection-change":{detail:{item:{type:HTMLElement}}}}};class N extends w{static get metadata(){return L}static get render(){return C}static get styles(){return f}static get staticAreaStyles(){return[g,_,v]}static get template(){return d}static get staticAreaTemplate(){return m}constructor(e){super(e);this._filteredItems=[];this._initialRendering=true;this._itemFocused=false;this._selectionChanged=false;this.i18nBundle=h.getI18nBundle("@ui5/webcomponents")}onBeforeRendering(){if(this._initialRendering){this._filteredItems=this.items}if(!this._initialRendering&&this.popover&&document.activeElement===this&&!this._filteredItems.length){this.popover.close()}this._selectMatchingItem();if(this._isKeyNavigation&&this.responsivePopover&&this.responsivePopover.opened){this.focused=false}else if(this.shadowRoot.activeElement){this.focused=this.shadowRoot.activeElement.id==="ui5-combobox-input"}this._initialRendering=false;this._isKeyNavigation=false}async onAfterRendering(){await this._respPopover();if(i.isPhone()&&this.responsivePopover.opened){this.inner.focus()}if(this.shouldClosePopover()&&!i.isPhone()){this.responsivePopover.close(false,false,true)}this._itemFocused=false;this.toggleValueStatePopover(this.shouldOpenValueStateMessagePopover);this.storeResponsivePopoverWidth()}shouldClosePopover(){return this.responsivePopover.opened&&!this.focused&&!this._itemFocused}_focusin(e){this.focused=true;this._lastValue=this.value;!i.isPhone()&&e.target.setSelectionRange(0,this.value.length)}_focusout(){this.focused=false;this._fireChangeEvent();!i.isPhone()&&this._closeRespPopover()}_afterOpenPopover(){this._iconPressed=true}_afterClosePopover(){this._iconPressed=false;this._filteredItems=this.items;if(i.isPhone()){this.blur()}if(this._selectionPerformed){this._lastValue=this.value;this._selectionPerformed=false}}_toggleRespPopover(){if(this.responsivePopover.opened){this._closeRespPopover()}else{this._openRespPopover()}}storeResponsivePopoverWidth(){if(this.open&&!this._listWidth){this._listWidth=this.responsivePopover.offsetWidth}}toggleValueStatePopover(e){if(e){this.openValueStatePopover()}else{this.closeValueStatePopover()}}async openValueStatePopover(){this.popover=await this._getPopover();this.popover&&this.popover.showAt(this)}async closeValueStatePopover(){this.popover=await this._getPopover();this.popover&&this.popover.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector(".ui5-valuestatemessage-popover")}_resetFilter(){this._filteredItems=this._filterItems("");this._selectMatchingItem()}_arrowClick(){this.inner.focus();this._resetFilter();this._toggleRespPopover()}_input(e){const{value:t}=e.target;if(e.target===this.inner){e.stopImmediatePropagation()}this._filteredItems=this._filterItems(t);this.value=t;this.filterValue=t;this._clearFocus();if(this._autocomplete&&t!==""){const e=this._autoCompleteValue(t);if(!this._selectionChanged&&(e&&!e.selected&&!e.isGroupItem)){this.fireEvent("selection-change",{item:e});this._selectionChanged=false;e.focused=true}}this.fireEvent("input");if(i.isPhone()){return}if(!this._filteredItems.length){this._closeRespPopover()}else{this._openRespPopover()}}_startsWithMatchingItems(e){return p.StartsWith(e,this._filteredItems)}_clearFocus(){this._filteredItems.map(e=>{e.focused=false;return e})}async handleArrowKeyPress(e){if(this.readonly||!this._filteredItems.length){return}const t=u.isDown(e);const s=u.isUp(e);const i=this._filteredItems.find(e=>this.responsivePopover.opened?e.focused:e.selected);let o=this._filteredItems.indexOf(i);e.preventDefault();if(o===0&&s||this._filteredItems.length-1===o&&t){return}this._clearFocus();o+=t?1:-1;o=o<0?0:o;this._filteredItems[o].focused=true;if(this.responsivePopover.opened){this.announceSelectedItem(o)}this.value=this._filteredItems[o].isGroupItem?this.filterValue:this._filteredItems[o].text;this._isKeyNavigation=true;this._itemFocused=true;this._selectionChanged=true;if(this._filteredItems[o].isGroupItem){return}this._filteredItems[o].selected=true;const r=this._autoCompleteValue(this.value);if(r&&!r.selected){this.fireEvent("selection-change",{item:r})}this.fireEvent("input");this._fireChangeEvent()}_keydown(e){const t=u.isDown(e)||u.isUp(e);this._autocomplete=!(u.isBackSpace(e)||u.isDelete(e));if(t){this.handleArrowKeyPress(e)}if(u.isEnter(e)){this._fireChangeEvent();this._closeRespPopover()}if(u.isShow(e)&&!this.readonly&&!this.disabled){e.preventDefault();this._resetFilter();this._toggleRespPopover()}}_click(e){if(i.isPhone()&&!this.readonly){this._openRespPopover()}}_closeRespPopover(e){if(i.isPhone()&&e&&e.target.classList.contains("ui5-responsive-popover-close-btn")&&this._selectedItemText){this.value=this._selectedItemText;this.filterValue=this._selectedItemText}this.responsivePopover.close()}_openRespPopover(){this.responsivePopover.showAt(this)}_filterItems(e){const t=this.items.filter(e=>!e.isGroupItem);const s=(p.Filters[this.filter]||p.StartsWithPerTerm)(e,t);return this.items.filter((e,t,i)=>N._groupItemFilter(e,++t,i,s)||s.indexOf(e)!==-1)}static _groupItemFilter(e,t,s,i){if(e.isGroupItem){let e;while(s[t]&&!s[t].isGroupItem&&!e){e=i.indexOf(s[t])!==-1;t++}return e}}_autoCompleteValue(e){const t=this.items.find(e=>e.focused===true);if(t&&t.isGroupItem){this.value=this.filterValue;return}const s=this._startsWithMatchingItems(e).filter(e=>!e.isGroupItem);if(s.length){this.value=s[0]?s[0].text:e}else{this.value=e}if(this._isKeyNavigation){setTimeout(()=>{this.inner.setSelectionRange(this.filterValue.length,this.value.length)},0)}else if(s.length){setTimeout(()=>{this.inner.setSelectionRange(this.filterValue.length,this.value.length)},0)}if(s.length){return s[0]}}_selectMatchingItem(){const e=this.items.find(e=>e.focused);const t=e&&e.isGroupItem;this._filteredItems=this._filteredItems.map(e=>{e.selected=!e.isGroupItem&&e.text===this.value&&!t;return e})}_fireChangeEvent(){if(this.value!==this._lastValue){this.fireEvent("change");this._lastValue=this.value}}_inputChange(e){e.preventDefault()}_itemMousedown(e){e.preventDefault()}_selectItem(e){const t=e.detail.item;this._selectedItemText=t.mappedItem.text;this._selectionPerformed=true;const s=this.value===this._selectedItemText;const i=this.value.toLowerCase()===this.filterValue.toLowerCase();if(s&&i){return this._closeRespPopover()}this.value=this._selectedItemText;if(!t.mappedItem.selected){this.fireEvent("selection-change",{item:t.mappedItem});this._selectionChanged=true}this._filteredItems.map(e=>{e.selected=e===t.mappedItem&&!e.isGroupItem;return e});this._fireChangeEvent();this._closeRespPopover();this.inner.setSelectionRange(this.value.length,this.value.length)}_onItemFocus(e){this._itemFocused=true}announceSelectedItem(e){const t=this.i18nBundle.getText(c.LIST_ITEM_POSITION,[e+1],[this._filteredItems.length]);const s=this.i18nBundle.getText(c.LIST_ITEM_SELECTED);M(`${t} ${s}`,"Polite")}get _headerTitleText(){return this.i18nBundle.getText(c.INPUT_SUGGESTIONS_TITLE)}get _iconAccessibleNameText(){return this.i18nBundle.getText(c.SELECT_OPTIONS)}get inner(){return i.isPhone()?this.responsivePopover.querySelector(".ui5-input-inner-phone"):this.shadowRoot.querySelector("[inner-input]")}async _respPopover(){const e=await this.getStaticAreaItemDomRef();this.responsivePopover=e.querySelector("[ui5-responsive-popover]");return this.responsivePopover}get editable(){return!this.readonly}get hasValueState(){return this.valueState!==B.None}get hasValueStateText(){return this.hasValueState&&this.valueState!==B.Success}get valueStateText(){return this.valueStateTextMappings[this.valueState]}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get valueStateTextMappings(){return{Success:this.i18nBundle.getText(c.VALUE_STATE_SUCCESS),Error:this.i18nBundle.getText(c.VALUE_STATE_ERROR),Warning:this.i18nBundle.getText(c.VALUE_STATE_WARNING),Information:this.i18nBundle.getText(c.VALUE_STATE_INFORMATION)}}get shouldOpenValueStateMessagePopover(){return this.focused&&this.hasValueStateText&&!this._iconPressed&&!this.open&&!this._isPhone}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateText}get open(){return this.responsivePopover?this.responsivePopover.opened:false}get _isPhone(){return i.isPhone()}get itemTabIndex(){return undefined}get ariaLabelText(){return r.getEffectiveAriaLabelText(this)}static get dependencies(){return[I,P,y,T,b,x,V,S,E]}get styles(){return{popoverHeader:{width:`${this.offsetWidth}px`},suggestionPopoverHeader:{display:this._listWidth===0?"none":"inline-block",width:`${this._listWidth}px`,padding:"0.9125rem 1rem"}}}get classes(){return{popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-valuestatemessage--success":this.valueState===B.Success,"ui5-valuestatemessage--error":this.valueState===B.Error,"ui5-valuestatemessage--warning":this.valueState===B.Warning,"ui5-valuestatemessage--information":this.valueState===B.Information}}}}N.define();return N});