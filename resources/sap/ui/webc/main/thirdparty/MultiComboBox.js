sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/icons/decline","sap/ui/webc/common/thirdparty/icons/multiselect-all","./MultiComboBoxItem","./Tokenizer","./Token","./Icon","./Popover","./ResponsivePopover","./List","./StandardListItem","./ToggleButton","./ComboBoxFilters-f59100bd","./Button","./generated/i18n/i18n-defaults","./generated/templates/MultiComboBoxTemplate.lit","./generated/templates/MultiComboBoxPopoverTemplate.lit","./generated/themes/MultiComboBox.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css"],function(e,t,s,i,o,a,n,r,l,u,h,d,c,p,g,m,f,_,v,S,y,T,I,P,b,w,k,x){"use strict";function B(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var R=B(e);var E=B(t);var M=B(s);var V=B(i);var C=B(a);const z={tag:"ui5-multi-combobox",languageAware:true,managedSlots:true,slots:{default:{propertyName:"items",type:HTMLElement,invalidateOnChildChange:true},icon:{type:HTMLElement},valueStateMessage:{type:HTMLElement}},properties:{value:{type:String,defaultValue:""},placeholder:{type:String,defaultValue:""},allowCustomValues:{type:Boolean},disabled:{type:Boolean},valueState:{type:V,defaultValue:V.None},readonly:{type:Boolean},required:{type:Boolean},filter:{type:String,defaultValue:"StartsWithPerTerm"},open:{type:Boolean},_filteredItems:{type:Object},filterSelected:{type:Boolean},focused:{type:Boolean},_tokenizerFocused:{type:Boolean},_iconPressed:{type:Boolean,noAttribute:true},_inputWidth:{type:C,noAttribute:true},_listWidth:{type:C,defaultValue:0,noAttribute:true}},events:{change:{},input:{},"open-change":{},"selection-change":{detail:{items:{type:Array}}}}};class D extends R{static get metadata(){return z}static get render(){return E}static get template(){return P}static get staticAreaTemplate(){return b}static get styles(){return w}static get staticAreaStyles(){return[k,x]}static get dependencies(){return[d,c,p,g,f,m,_,v,S,T]}constructor(){super();this._filteredItems=[];this.selectedValues=[];this._inputLastValue="";this._deleting=false;this._validationTimeout=null;this.i18nBundle=l.getI18nBundle("@ui5/webcomponents");this._handleResizeBound=this._handleResize.bind(this)}onEnterDOM(){M.register(this,this._handleResizeBound)}onExitDOM(){M.deregister(this,this._handleResizeBound)}_handleResize(){this._inputWidth=this.offsetWidth}_inputChange(){this.fireEvent("change")}_showMorePopover(){this.filterSelected=true;this._toggleRespPopover()}togglePopover(){if(!r.isPhone()){this._inputDom.focus()}this._toggleRespPopover()}filterSelectedItems(e){if(this.allItemsSelected){this.filterSelected=true;return}this.filterSelected=e.target.pressed}get _showAllItemsButtonPressed(){return this.filterSelected||this.allItemsSelected}get allItemsSelected(){return this.items.length===this.selectedValues.length}get _inputDom(){return this.shadowRoot.querySelector("#ui5-multi-combobox-input")}_inputLiveChange(e){const t=e.target;const s=t.value;const i=this._filterItems(s);const o=this.valueState;const a=this._inputDom.value===this.value&&r.isIE()&&!this._keyDown&&!!this.placeholder;if(a){e.preventDefault();return}if(this._validationTimeout){t.value=this._inputLastValue;return}if(!i.length&&s&&!this.allowCustomValues){t.value=this._inputLastValue;this.valueState="Error";this._validationTimeout=setTimeout(()=>{this.valueState=o;this._validationTimeout=null},2e3);return}this._inputLastValue=t.value;this.value=t.value;this._filteredItems=i;if(!r.isPhone()){if(i.length===0){this.allItemsPopover.close()}else{this.allItemsPopover.showAt(this)}}this.fireEvent("input")}_tokenDelete(e){const t=e.detail.ref;const s=this.items.find(e=>e._id===t.getAttribute("data-ui5-id"));s.selected=false;this._deleting=true;this.fireSelectionChange()}get _getPlaceholder(){if(this._tokenizer&&this._tokenizer.tokens.length){return""}return this.placeholder}_handleLeft(){const e=this.getDomRef().querySelector(`input`).selectionStart;if(e===0){this._tokenizer._focusLastToken()}}_tokenizerFocusOut(e){this._tokenizerFocused=false;const t=this._tokenizer.tokens.length-1;if(!e.relatedTarget||e.relatedTarget.localName!=="ui5-token"){this._tokenizer.tokens.forEach(e=>{e.selected=false});this._tokenizer.scrollToStart()}if(t===0&&this._deleting){setTimeout(()=>{if(!r.isPhone()){this.shadowRoot.querySelector("input").focus()}this._deleting=false},0)}}_tokenizerFocusIn(){this._tokenizerFocused=true;this.focused=false}_onkeyup(){this._keyDown=false}async _onkeydown(e){if(o.isLeft(e)){this._handleLeft(e)}if(o.isShow(e)&&!this.readonly&&!this.disabled){e.preventDefault();this._toggleRespPopover()}if(o.isDown(e)&&this.allItemsPopover.opened&&this.items.length){e.preventDefault();await this._getList();const t=this.list.items[0];this.list._itemNavigation.setCurrentItem(t);t.focus()}if(o.isBackSpace(e)&&e.target.value===""){e.preventDefault();this._tokenizer._focusLastToken()}this._keyDown=true}_onTokenizerKeydown(e){if(o.isRight(e)){const e=this._tokenizer.tokens.length-1;if(this._tokenizer.tokens[e]===document.activeElement.shadowRoot.activeElement){setTimeout(()=>{this.shadowRoot.querySelector("input").focus()},0)}}}_filterItems(e){return(y.Filters[this.filter]||y.StartsWithPerTerm)(e,this.items)}_toggle(){this.open=!this.open;this.fireEvent("open-change");if(!this.open){this._afterClosePopover()}}_getSelectedItems(){this.selectedValues=this.items.filter(e=>e.selected);return this.selectedValues}_listSelectionChange(e){e.target.items.forEach(e=>{this.items.forEach(t=>{if(t._id===e.getAttribute("data-ui5-token-id")){t.selected=e.selected}})});this.fireSelectionChange();if(!e.detail.selectionComponentPressed&&!o.isSpace(e.detail)){this.allItemsPopover.close();this.value="";this.fireEvent("input")}}fireSelectionChange(){this.fireEvent("selection-change",{items:this._getSelectedItems()});this.fireEvent("value-changed")}async _getRespPopover(){const e=await this.getStaticAreaItemDomRef();this.allItemsPopover=e.querySelector(`.ui5-multi-combobox-all-items-responsive-popover`)}async _getList(){const e=await this.getStaticAreaItemDomRef();this.list=e.querySelector(".ui5-multi-combobox-all-items-list")}_toggleRespPopover(){this.allItemsPopover.toggle(this)}_click(e){if(r.isPhone()&&!this.readonly&&!this._showMorePressed){this.allItemsPopover.showAt(this)}this._showMorePressed=false}_afterClosePopover(){if(r.isPhone()){this.blur()}this._iconPressed=false;this.filterSelected=false}onBeforeRendering(){const e=this.shadowRoot.querySelector("input");this._inputLastValue=this.value;if(e&&!e.value){this._filteredItems=this.items}const t=this._filterItems(this.value);this._filteredItems=t;if(r.isPhone()&&this.allItemsPopover&&this.allItemsPopover.opened){this.allItemsPopover.focus()}}async onAfterRendering(){await this._getRespPopover();await this._getList();this.toggle(this.shouldDisplayOnlyValueStateMessage);this.storeResponsivePopoverWidth()}get _isPhone(){return r.isPhone()}_onIconMousedown(){this._iconPressed=true}storeResponsivePopoverWidth(){if(this.open&&!this._listWidth){this._listWidth=this.list.offsetWidth}}toggle(e){if(e&&!this.open){this.openPopover()}else{this.closePopover()}}async openPopover(){const e=await this._getPopover();if(e){e.showAt(this)}}async closePopover(){const e=await this._getPopover();e&&e.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-popover]")}get _tokenizer(){return this.shadowRoot.querySelector("[ui5-tokenizer]")}inputFocusIn(){if(!r.isPhone()){this.focused=true}}inputFocusOut(e){if(!this.shadowRoot.contains(e.relatedTarget)&&!this._deleting){this.focused=false}}get editable(){return!this.readonly}get _isFocusInside(){return this.focused||this._tokenizerFocused}get selectedItemsListMode(){return this.readonly?"None":"MultiSelect"}get _listItemsType(){return this.readonly?"Inactive":"Active"}get hasValueState(){return this.valueState!==V.None}get hasValueStateMessage(){return this.hasValueState&&this.valueState!==V.Success}get valueStateText(){return this.valueStateTextMappings[this.valueState]}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get _tokensCountText(){if(!this._tokenizer){return}return this._tokenizer._tokensCountText()}get _tokensCountTextId(){return`${this._id}-hiddenText-nMore`}get ariaDescribedByText(){return this.valueStateTextId?`${this._tokensCountTextId} ${this.valueStateTextId}`:`${this._tokensCountTextId}`}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateMessage}get shouldDisplayOnlyValueStateMessage(){return this.focused&&this.hasValueStateMessage&&!this._iconPressed}get valueStateTextMappings(){return{Success:this.i18nBundle.getText(I.VALUE_STATE_SUCCESS),Error:this.i18nBundle.getText(I.VALUE_STATE_ERROR),Warning:this.i18nBundle.getText(I.VALUE_STATE_WARNING)}}get _innerInput(){if(r.isPhone()){if(this.allItemsPopover.opened){return this.allItemsPopover.querySelector("input")}}return this.getDomRef().querySelector("#ui5-multi-combobox-input")}get _headerTitleText(){return this.i18nBundle.getText(I.INPUT_SUGGESTIONS_TITLE)}get _iconAccessibleNameText(){return this.i18nBundle.getText(I.SELECT_OPTIONS)}get _dialogOkButton(){return this.i18nBundle.getText(I.MULTICOMBOBOX_DIALOG_OK_BUTTON)}get _tokenizerExpanded(){return(this._isFocusInside||this.open)&&!this.readonly}get classes(){return{popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-valuestatemessage--success":this.valueState===V.Success,"ui5-valuestatemessage--error":this.valueState===V.Error,"ui5-valuestatemessage--warning":this.valueState===V.Warning,"ui5-valuestatemessage--information":this.valueState===V.Information}}}get styles(){return{popoverValueStateMessage:{width:`${this._listWidth}px`,display:this._listWidth===0?"none":"inline-block",padding:"0.9125rem 1rem"},popoverHeader:{"max-width":`${this._inputWidth}px`}}}static async onDefine(){await l.fetchI18nBundle("@ui5/webcomponents")}}D.define();return D});