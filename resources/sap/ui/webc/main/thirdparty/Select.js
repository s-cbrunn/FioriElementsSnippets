sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/icons/decline","./generated/i18n/i18n-defaults","./Option","./Label","./ResponsivePopover","./Popover","./List","./StandardListItem","./Icon","./Button","./generated/templates/SelectTemplate.lit","./generated/templates/SelectPopoverTemplate.lit","./generated/themes/Select.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/SelectPopover.css"],function(e,t,s,i,n,o,a,r,l,h,d,c,p,u,_,g,f,v,m,S,x,I,y,P,b,T){"use strict";function O(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var w=O(e);var E=O(t);var C=O(i);var A=O(a);const V={tag:"ui5-select",languageAware:true,managedSlots:true,slots:{default:{propertyName:"options",type:HTMLElement,invalidateOnChildChange:true},valueStateMessage:{type:HTMLElement},formSupport:{type:HTMLElement}},properties:{disabled:{type:Boolean},name:{type:String},valueState:{type:A,defaultValue:A.None},required:{type:Boolean},accessibleName:{type:String},accessibleNameRef:{type:String,defaultValue:""},_text:{type:String,noAttribute:true},_iconPressed:{type:Boolean,noAttribute:true},opened:{type:Boolean},_listWidth:{type:C,defaultValue:0,noAttribute:true},focused:{type:Boolean}},events:{change:{detail:{selectedOption:{}}}}};class R extends w{static get metadata(){return V}static get render(){return E}static get template(){return x}static get staticAreaTemplate(){return I}static get styles(){return y}static get staticAreaStyles(){return[P,b,T]}constructor(){super();this._syncedOptions=[];this._selectedIndex=-1;this._selectedIndexBeforeOpen=-1;this._escapePressed=false;this._lastSelectedOption=null;this._typedChars="";this._typingTimeoutID=-1;this.i18nBundle=h.getI18nBundle("@ui5/webcomponents")}onBeforeRendering(){this._syncSelection();this._enableFormSupport()}onAfterRendering(){this.toggleValueStatePopover(this.shouldOpenValueStateMessagePopover);if(this._isPickerOpen){if(!this._listWidth){this._listWidth=this.responsivePopover.offsetWidth}}}_onfocusin(){this.focused=true}_onfocusout(){this.focused=false;this.itemSelectionAnnounce()}get _isPickerOpen(){return!!this.responsivePopover&&this.responsivePopover.opened}async _respPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-responsive-popover]")}get selectedOption(){return this.options.find(e=>e.selected)}async _toggleRespPopover(){this._iconPressed=true;this.responsivePopover=await this._respPopover();if(this.disabled){return}if(this._isPickerOpen){this.responsivePopover.close()}else{this.responsivePopover.showAt(this)}}_syncSelection(){let e=-1,t=-1;const s=this.options.map((s,i)=>{if(s.selected||s.textContent===this.value){e=i}if(!s.disabled&&t===-1){t=i}s.selected=false;s._focused=false;return{selected:false,_focused:false,disabled:s.disabled,icon:s.icon,value:s.value,textContent:s.textContent,id:s._id,stableDomRef:s.stableDomRef}});if(e>-1&&!s[e].disabled){s[e].selected=true;s[e]._focused=true;this.options[e].selected=true;this.options[e]._focused=true;this._text=s[e].textContent;this._selectedIndex=e}else{this._text="";this._selectedIndex=-1;if(s[t]){s[t].selected=true;s[t]._focused=true;this.options[t].selected=true;this.options[t]._focused=true;this._selectedIndex=t;this._text=this.options[t].textContent}}this._syncedOptions=s}_enableFormSupport(){const e=n.getFeature("FormSupport");if(e){e.syncNativeHiddenInput(this,(e,t)=>{t.disabled=e.disabled;t.value=e._currentlySelectedOption?e._currentlySelectedOption.value:""})}else if(this.name){console.warn(`In order for the "name" property to have effect, you should also: import "@ui5/webcomponents/dist/features/InputElementsFormSupport.js";`)}}_onkeydown(e){const t=s.isTabNext(e)||s.isTabPrevious(e);if(t&&this.responsivePopover&&this.responsivePopover.opened){this.responsivePopover.close()}if(s.isShow(e)){e.preventDefault();this._toggleRespPopover()}else if(s.isSpace(e)){e.preventDefault()}else if(s.isEscape(e)&&this._isPickerOpen){this._escapePressed=true}else if(s.isHome(e)){this._handleHomeKey(e)}else if(s.isEnd(e)){this._handleEndKey(e)}else if(s.isEnter(e)){this._handleSelectionChange()}else if(s.isUp(e)||s.isDown(e)){this._handleArrowNavigation(e)}}_handleKeyboardNavigation(e){if(s.isEnter(e)){return}const t=e.key.toLowerCase();this._typedChars+=t;const i=/^(.)\1+$/i.test(this._typedChars)?t:this._typedChars;clearTimeout(this._typingTimeoutID);this._typingTimeoutID=setTimeout(()=>{this._typedChars="";this._typingTimeoutID=-1},1e3);this._selectTypedItem(i)}_selectTypedItem(e){const t=this._selectedIndex;const s=this._searchNextItemByText(e);if(s){const e=this._getSelectedItemIndex(s);this._changeSelectedItem(this._selectedIndex,e);if(t!==this._selectedIndex){this.itemSelectionAnnounce()}}}_searchNextItemByText(e){let t=this.options.slice(0);const s=t.splice(this._selectedIndex+1,t.length-this._selectedIndex);const i=t.splice(0,t.length-1);t=s.concat(i);return t.find(t=>t.textContent.toLowerCase().startsWith(e))}_handleHomeKey(e){e.preventDefault();this._changeSelectedItem(this._selectedIndex,0)}_handleEndKey(e){const t=this.options.length-1;e.preventDefault();this._changeSelectedItem(this._selectedIndex,t)}_onkeyup(e){if(s.isSpace(e)){if(this._isPickerOpen){this._handleSelectionChange()}else{this._toggleRespPopover()}}}_getSelectedItemIndex(e){return[].indexOf.call(e.parentElement.children,e)}_select(e){this.options[this._selectedIndex].selected=false;this._selectedIndex=e;this.options[e].selected=true}_handleItemPress(e){const t=e.detail.item;const s=this._getSelectedItemIndex(t);this._handleSelectionChange(s)}_itemMousedown(e){e.preventDefault()}_onclick(e){this.getFocusDomRef().focus();this._toggleRespPopover()}_handleSelectionChange(e=this._selectedIndex){this._select(e);this._toggleRespPopover()}_handleArrowNavigation(e){let t=-1;const i=this._selectedIndex;const n=s.isDown(e);e.preventDefault();if(n){t=this._getNextOptionIndex()}else{t=this._getPreviousOptionIndex()}this._changeSelectedItem(this._selectedIndex,t);if(i!==this._selectedIndex){this.itemSelectionAnnounce()}}_changeSelectedItem(e,t){this.options[e].selected=false;this.options[e]._focused=false;this.options[t].selected=true;this.options[t]._focused=true;this._selectedIndex=t;if(!this._isPickerOpen){this._fireChangeEvent(this.options[t])}}_getNextOptionIndex(){return this._selectedIndex===this.options.length-1?this._selectedIndex:this._selectedIndex+1}_getPreviousOptionIndex(){return this._selectedIndex===0?this._selectedIndex:this._selectedIndex-1}_beforeOpen(){this._selectedIndexBeforeOpen=this._selectedIndex;this._lastSelectedOption=this.options[this._selectedIndex]}_afterOpen(){this.opened=true}_afterClose(){this.opened=false;this._iconPressed=false;this._listWidth=0;if(this._escapePressed){this._select(this._selectedIndexBeforeOpen);this._escapePressed=false}else if(this._lastSelectedOption!==this.options[this._selectedIndex]){this._fireChangeEvent(this.options[this._selectedIndex]);this._lastSelectedOption=this.options[this._selectedIndex]}}_fireChangeEvent(e){this.fireEvent("change",{selectedOption:e});this.selectedItem=e.textContent;this.fireEvent("selected-item-changed")}get valueStateTextMappings(){const e=this.i18nBundle;return{Success:e.getText(c.VALUE_STATE_SUCCESS),Information:e.getText(c.VALUE_STATE_INFORMATION),Error:e.getText(c.VALUE_STATE_ERROR),Warning:e.getText(c.VALUE_STATE_WARNING)}}get valueStateText(){return this.valueStateTextMappings[this.valueState]}get hasValueState(){return this.valueState!==A.None}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get isDisabled(){return this.disabled||undefined}get _headerTitleText(){return this.i18nBundle.getText(c.INPUT_SUGGESTIONS_TITLE)}get _currentSelectedItem(){return this.shadowRoot.querySelector(`#${this.options[this._selectedIndex]._id}-li`)}get _currentlySelectedOption(){return this.options[this._selectedIndex]}get tabIndex(){return this.disabled||this.responsivePopover&&this.responsivePopover.opened?"-1":"0"}get classes(){return{popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-valuestatemessage--success":this.valueState===A.Success,"ui5-valuestatemessage--error":this.valueState===A.Error,"ui5-valuestatemessage--warning":this.valueState===A.Warning,"ui5-valuestatemessage--information":this.valueState===A.Information}}}get styles(){return{popoverHeader:{"max-width":`${this.offsetWidth}px`},responsivePopoverHeader:{display:this.options.length&&this._listWidth===0?"none":"inline-block",width:`${this.options.length?this._listWidth:this.offsetWidth}px`}}}get ariaLabelText(){return o.getEffectiveAriaLabelText(this)}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateText}get hasValueStateText(){return this.hasValueState&&this.valueState!==A.Success}get shouldOpenValueStateMessagePopover(){return this.focused&&this.hasValueStateText&&!this._iconPressed&&!this._isPickerOpen&&!this._isPhone}get _isPhone(){return l.isPhone()}itemSelectionAnnounce(){const e=this.shadowRoot.querySelector(`#${this._id}-selectionText`);if(this.focused&&this._currentlySelectedOption){e.textContent=this._currentlySelectedOption.textContent}else{e.textContent=""}}async openValueStatePopover(){this.popover=await this._getPopover();if(this.popover){this.popover.showAt(this)}}closeValueStatePopover(){this.popover&&this.popover.close()}toggleValueStatePopover(e){if(e){this.openValueStatePopover()}else{this.closeValueStatePopover()}}get selectedOptionIcon(){return this.selectedOption&&this.selectedOption.icon}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-popover]")}static get dependencies(){return[p,u,_,g,f,v,m,S]}}R.define();return R});